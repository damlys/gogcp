image: damlys/gogcp-devcontainer:0.1.0
definitions:
  caches:
    scopes-core-terraform-modules-main: scopes/core/terraform-modules/main/.terraform
    scopes-core-terraform-modules-prod: scopes/core/terraform-modules/prod/.terraform
    scopes-core-terraform-modules-test: scopes/core/terraform-modules/test/.terraform
    scopes-core-terraform-submodules-gcp-docker-images-registry: scopes/core/terraform-submodules/gcp-docker-images-registry/.terraform
    scopes-core-terraform-submodules-gcp-helm-charts-registry: scopes/core/terraform-submodules/gcp-helm-charts-registry/.terraform
    scopes-core-terraform-submodules-gcp-project: scopes/core/terraform-submodules/gcp-project/.terraform
    scopes-core-terraform-submodules-gcp-terraform-modules-registry: scopes/core/terraform-submodules/gcp-terraform-modules-registry/.terraform
    scopes-core-terraform-submodules-gcp-terraform-state-bucket: scopes/core/terraform-submodules/gcp-terraform-state-bucket/.terraform
    scopes-core-terraform-submodules-gke-gateway-route: scopes/core/terraform-submodules/gke-gateway-route/.terraform
    scopes-core-terraform-submodules-gke-platform: scopes/core/terraform-submodules/gke-platform/.terraform
    scopes-core-terraform-submodules-gke-service-account: scopes/core/terraform-submodules/gke-service-account/.terraform
    scopes-kuard-terraform-modules-kuard: scopes/kuard/terraform-modules/kuard/.terraform
    scopes-kuard-terraform-submodules-helm-release: scopes/kuard/terraform-submodules/helm-release/.terraform
    scopes-kuard-terraform-submodules-kuard: scopes/kuard/terraform-submodules/kuard/.terraform
    scopes-o11y-terraform-modules-test-monitor: scopes/o11y/terraform-modules/test-monitor/.terraform
    scopes-o11y-terraform-submodules-gcp-availability-monitor: scopes/o11y/terraform-submodules/gcp-availability-monitor/.terraform
    scopes-o11y-terraform-submodules-gke-lgtm-stack: scopes/o11y/terraform-submodules/gke-lgtm-stack/.terraform
    scopes-o11y-terraform-submodules-k8s-otel-collectors: scopes/o11y/terraform-submodules/k8s-otel-collectors/.terraform
  scripts:
    - &auth |
      set -e
      echo "$GOOGLE_CREDENTIALS" | gcloud auth activate-service-account --key-file="/dev/stdin"
      export GOOGLE_APPLICATION_CREDENTIALS="/tmp/GOOGLE_APPLICATION_CREDENTIALS.json" && echo "$GOOGLE_CREDENTIALS" >"$GOOGLE_APPLICATION_CREDENTIALS"
      gcloud auth configure-docker "europe-central2-docker.pkg.dev"
      gcloud auth print-access-token | helm registry login --username="oauth2accesstoken" --password-stdin "europe-central2-docker.pkg.dev"
  steps:
    - step: &test-scopes-core-docker-images-devcontainer
        name: test scopes/core/docker-images/devcontainer
        condition:
          changesets:
            includePaths:
              - "scopes/core/docker-images/devcontainer/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "scopes/core/docker-images/devcontainer"
          - ./scripts/docker-image test "scopes/core/docker-images/devcontainer"
          - ./scripts/docker-image pre-publish "scopes/core/docker-images/devcontainer"
          - ./scripts/docker-image show "scopes/core/docker-images/devcontainer"
    - step: &publish-scopes-core-docker-images-devcontainer
        name: publish scopes/core/docker-images/devcontainer
        condition:
          changesets:
            includePaths:
              - "scopes/core/docker-images/devcontainer/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "scopes/core/docker-images/devcontainer"
          - ./scripts/docker-image test "scopes/core/docker-images/devcontainer"
          - ./scripts/docker-image publish "scopes/core/docker-images/devcontainer"
          - ./scripts/docker-image show "scopes/core/docker-images/devcontainer"
    - step: &test-scopes-core-docker-images-go-rte
        name: test scopes/core/docker-images/go-rte
        condition:
          changesets:
            includePaths:
              - "scopes/core/docker-images/go-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "scopes/core/docker-images/go-rte"
          - ./scripts/docker-image test "scopes/core/docker-images/go-rte"
          - ./scripts/docker-image pre-publish "scopes/core/docker-images/go-rte"
          - ./scripts/docker-image show "scopes/core/docker-images/go-rte"
    - step: &publish-scopes-core-docker-images-go-rte
        name: publish scopes/core/docker-images/go-rte
        condition:
          changesets:
            includePaths:
              - "scopes/core/docker-images/go-rte/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "scopes/core/docker-images/go-rte"
          - ./scripts/docker-image test "scopes/core/docker-images/go-rte"
          - ./scripts/docker-image publish "scopes/core/docker-images/go-rte"
          - ./scripts/docker-image show "scopes/core/docker-images/go-rte"
    - step: &test-scopes-core-docker-images-go-sdk
        name: test scopes/core/docker-images/go-sdk
        condition:
          changesets:
            includePaths:
              - "scopes/core/docker-images/go-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "scopes/core/docker-images/go-sdk"
          - ./scripts/docker-image test "scopes/core/docker-images/go-sdk"
          - ./scripts/docker-image pre-publish "scopes/core/docker-images/go-sdk"
          - ./scripts/docker-image show "scopes/core/docker-images/go-sdk"
    - step: &publish-scopes-core-docker-images-go-sdk
        name: publish scopes/core/docker-images/go-sdk
        condition:
          changesets:
            includePaths:
              - "scopes/core/docker-images/go-sdk/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "scopes/core/docker-images/go-sdk"
          - ./scripts/docker-image test "scopes/core/docker-images/go-sdk"
          - ./scripts/docker-image publish "scopes/core/docker-images/go-sdk"
          - ./scripts/docker-image show "scopes/core/docker-images/go-sdk"
    - step: &validate-scopes-core-terraform-modules-main
        name: validate scopes/core/terraform-modules/main
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-modules/main/**"
        caches:
          - scopes-core-terraform-modules-main
        script:
          - *auth
          - ./scripts/terraform-module test "scopes/core/terraform-modules/main"
    - step: &plan-scopes-core-terraform-modules-main
        name: plan scopes/core/terraform-modules/main
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-modules/main/**"
        caches:
          - scopes-core-terraform-modules-main
        script:
          - *auth
          - terraform -chdir="scopes/core/terraform-modules/main" init -input="false"
          - terraform -chdir="scopes/core/terraform-modules/main" plan -input="false"
    - step: &apply-scopes-core-terraform-modules-main
        name: apply scopes/core/terraform-modules/main
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-modules/main/**"
        caches:
          - scopes-core-terraform-modules-main
        script:
          - *auth
          - terraform -chdir="scopes/core/terraform-modules/main" init -input="false"
          - terraform -chdir="scopes/core/terraform-modules/main" apply -input="false" -auto-approve
        trigger: manual
    - step: &validate-scopes-core-terraform-modules-prod
        name: validate scopes/core/terraform-modules/prod
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-modules/prod/**"
        caches:
          - scopes-core-terraform-modules-prod
        script:
          - *auth
          - ./scripts/terraform-module test "scopes/core/terraform-modules/prod"
    - step: &plan-scopes-core-terraform-modules-prod
        name: plan scopes/core/terraform-modules/prod
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-modules/prod/**"
        caches:
          - scopes-core-terraform-modules-prod
        script:
          - *auth
          - terraform -chdir="scopes/core/terraform-modules/prod" init -input="false"
          - terraform -chdir="scopes/core/terraform-modules/prod" plan -input="false"
    - step: &apply-scopes-core-terraform-modules-prod
        name: apply scopes/core/terraform-modules/prod
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-modules/prod/**"
        caches:
          - scopes-core-terraform-modules-prod
        script:
          - *auth
          - terraform -chdir="scopes/core/terraform-modules/prod" init -input="false"
          - terraform -chdir="scopes/core/terraform-modules/prod" apply -input="false" -auto-approve
        trigger: manual
    - step: &validate-scopes-core-terraform-modules-test
        name: validate scopes/core/terraform-modules/test
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-modules/test/**"
        caches:
          - scopes-core-terraform-modules-test
        script:
          - *auth
          - ./scripts/terraform-module test "scopes/core/terraform-modules/test"
    - step: &plan-scopes-core-terraform-modules-test
        name: plan scopes/core/terraform-modules/test
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-modules/test/**"
        caches:
          - scopes-core-terraform-modules-test
        script:
          - *auth
          - terraform -chdir="scopes/core/terraform-modules/test" init -input="false"
          - terraform -chdir="scopes/core/terraform-modules/test" plan -input="false"
    - step: &apply-scopes-core-terraform-modules-test
        name: apply scopes/core/terraform-modules/test
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-modules/test/**"
        caches:
          - scopes-core-terraform-modules-test
        script:
          - *auth
          - terraform -chdir="scopes/core/terraform-modules/test" init -input="false"
          - terraform -chdir="scopes/core/terraform-modules/test" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-scopes-core-terraform-submodules-gcp-docker-images-registry
        name: test scopes/core/terraform-submodules/gcp-docker-images-registry
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-docker-images-registry/**"
        caches:
          - scopes-core-terraform-submodules-gcp-docker-images-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule pre-publish "scopes/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-docker-images-registry"
    - step: &publish-scopes-core-terraform-submodules-gcp-docker-images-registry
        name: publish scopes/core/terraform-submodules/gcp-docker-images-registry
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-docker-images-registry/**"
        caches:
          - scopes-core-terraform-submodules-gcp-docker-images-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule publish "scopes/core/terraform-submodules/gcp-docker-images-registry"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-docker-images-registry"
    - step: &test-scopes-core-terraform-submodules-gcp-helm-charts-registry
        name: test scopes/core/terraform-submodules/gcp-helm-charts-registry
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-helm-charts-registry/**"
        caches:
          - scopes-core-terraform-submodules-gcp-helm-charts-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule pre-publish "scopes/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-helm-charts-registry"
    - step: &publish-scopes-core-terraform-submodules-gcp-helm-charts-registry
        name: publish scopes/core/terraform-submodules/gcp-helm-charts-registry
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-helm-charts-registry/**"
        caches:
          - scopes-core-terraform-submodules-gcp-helm-charts-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule publish "scopes/core/terraform-submodules/gcp-helm-charts-registry"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-helm-charts-registry"
    - step: &test-scopes-core-terraform-submodules-gcp-project
        name: test scopes/core/terraform-submodules/gcp-project
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-project/**"
        caches:
          - scopes-core-terraform-submodules-gcp-project
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule pre-publish "scopes/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-project"
    - step: &publish-scopes-core-terraform-submodules-gcp-project
        name: publish scopes/core/terraform-submodules/gcp-project
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-project/**"
        caches:
          - scopes-core-terraform-submodules-gcp-project
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule publish "scopes/core/terraform-submodules/gcp-project"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-project"
    - step: &test-scopes-core-terraform-submodules-gcp-terraform-modules-registry
        name: test scopes/core/terraform-submodules/gcp-terraform-modules-registry
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-terraform-modules-registry/**"
        caches:
          - scopes-core-terraform-submodules-gcp-terraform-modules-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule pre-publish "scopes/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-terraform-modules-registry"
    - step: &publish-scopes-core-terraform-submodules-gcp-terraform-modules-registry
        name: publish scopes/core/terraform-submodules/gcp-terraform-modules-registry
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-terraform-modules-registry/**"
        caches:
          - scopes-core-terraform-submodules-gcp-terraform-modules-registry
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule publish "scopes/core/terraform-submodules/gcp-terraform-modules-registry"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-terraform-modules-registry"
    - step: &test-scopes-core-terraform-submodules-gcp-terraform-state-bucket
        name: test scopes/core/terraform-submodules/gcp-terraform-state-bucket
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-terraform-state-bucket/**"
        caches:
          - scopes-core-terraform-submodules-gcp-terraform-state-bucket
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule pre-publish "scopes/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-terraform-state-bucket"
    - step: &publish-scopes-core-terraform-submodules-gcp-terraform-state-bucket
        name: publish scopes/core/terraform-submodules/gcp-terraform-state-bucket
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gcp-terraform-state-bucket/**"
        caches:
          - scopes-core-terraform-submodules-gcp-terraform-state-bucket
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule publish "scopes/core/terraform-submodules/gcp-terraform-state-bucket"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gcp-terraform-state-bucket"
    - step: &test-scopes-core-terraform-submodules-gke-gateway-route
        name: test scopes/core/terraform-submodules/gke-gateway-route
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gke-gateway-route/**"
        caches:
          - scopes-core-terraform-submodules-gke-gateway-route
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule pre-publish "scopes/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gke-gateway-route"
    - step: &publish-scopes-core-terraform-submodules-gke-gateway-route
        name: publish scopes/core/terraform-submodules/gke-gateway-route
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gke-gateway-route/**"
        caches:
          - scopes-core-terraform-submodules-gke-gateway-route
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule publish "scopes/core/terraform-submodules/gke-gateway-route"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gke-gateway-route"
    - step: &test-scopes-core-terraform-submodules-gke-platform
        name: test scopes/core/terraform-submodules/gke-platform
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gke-platform/**"
        caches:
          - scopes-core-terraform-submodules-gke-platform
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule pre-publish "scopes/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gke-platform"
    - step: &publish-scopes-core-terraform-submodules-gke-platform
        name: publish scopes/core/terraform-submodules/gke-platform
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gke-platform/**"
        caches:
          - scopes-core-terraform-submodules-gke-platform
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule publish "scopes/core/terraform-submodules/gke-platform"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gke-platform"
    - step: &test-scopes-core-terraform-submodules-gke-service-account
        name: test scopes/core/terraform-submodules/gke-service-account
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gke-service-account/**"
        caches:
          - scopes-core-terraform-submodules-gke-service-account
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule pre-publish "scopes/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gke-service-account"
    - step: &publish-scopes-core-terraform-submodules-gke-service-account
        name: publish scopes/core/terraform-submodules/gke-service-account
        condition:
          changesets:
            includePaths:
              - "scopes/core/terraform-submodules/gke-service-account/**"
        caches:
          - scopes-core-terraform-submodules-gke-service-account
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule test "scopes/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule publish "scopes/core/terraform-submodules/gke-service-account"
          - ./scripts/terraform-submodule show "scopes/core/terraform-submodules/gke-service-account"
    - step: &test-scopes-kuard-docker-images-kuard
        name: test scopes/kuard/docker-images/kuard
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/docker-images/kuard/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "scopes/kuard/docker-images/kuard"
          - ./scripts/docker-image test "scopes/kuard/docker-images/kuard"
          - ./scripts/docker-image pre-publish "scopes/kuard/docker-images/kuard"
          - ./scripts/docker-image show "scopes/kuard/docker-images/kuard"
    - step: &publish-scopes-kuard-docker-images-kuard
        name: publish scopes/kuard/docker-images/kuard
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/docker-images/kuard/**"
        services:
          - docker
        caches:
          - docker
        script:
          - *auth
          - ./scripts/docker-image build "scopes/kuard/docker-images/kuard"
          - ./scripts/docker-image test "scopes/kuard/docker-images/kuard"
          - ./scripts/docker-image publish "scopes/kuard/docker-images/kuard"
          - ./scripts/docker-image show "scopes/kuard/docker-images/kuard"
    - step: &test-scopes-kuard-helm-charts-kuard
        name: test scopes/kuard/helm-charts/kuard
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/helm-charts/kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "scopes/kuard/helm-charts/kuard"
          - ./scripts/helm-chart test "scopes/kuard/helm-charts/kuard"
          - ./scripts/helm-chart pre-publish "scopes/kuard/helm-charts/kuard"
          - ./scripts/helm-chart show "scopes/kuard/helm-charts/kuard"
    - step: &publish-scopes-kuard-helm-charts-kuard
        name: publish scopes/kuard/helm-charts/kuard
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/helm-charts/kuard/**"
        script:
          - *auth
          - ./scripts/helm-chart build "scopes/kuard/helm-charts/kuard"
          - ./scripts/helm-chart test "scopes/kuard/helm-charts/kuard"
          - ./scripts/helm-chart publish "scopes/kuard/helm-charts/kuard"
          - ./scripts/helm-chart show "scopes/kuard/helm-charts/kuard"
    - step: &validate-scopes-kuard-terraform-modules-kuard
        name: validate scopes/kuard/terraform-modules/kuard
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/terraform-modules/kuard/**"
        caches:
          - scopes-kuard-terraform-modules-kuard
        script:
          - *auth
          - ./scripts/terraform-module test "scopes/kuard/terraform-modules/kuard"
    - step: &plan-scopes-kuard-terraform-modules-kuard
        name: plan scopes/kuard/terraform-modules/kuard
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/terraform-modules/kuard/**"
        caches:
          - scopes-kuard-terraform-modules-kuard
        script:
          - *auth
          - terraform -chdir="scopes/kuard/terraform-modules/kuard" init -input="false"
          - terraform -chdir="scopes/kuard/terraform-modules/kuard" plan -input="false"
    - step: &apply-scopes-kuard-terraform-modules-kuard
        name: apply scopes/kuard/terraform-modules/kuard
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/terraform-modules/kuard/**"
        caches:
          - scopes-kuard-terraform-modules-kuard
        script:
          - *auth
          - terraform -chdir="scopes/kuard/terraform-modules/kuard" init -input="false"
          - terraform -chdir="scopes/kuard/terraform-modules/kuard" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-scopes-kuard-terraform-submodules-helm-release
        name: test scopes/kuard/terraform-submodules/helm-release
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/terraform-submodules/helm-release/**"
        caches:
          - scopes-kuard-terraform-submodules-helm-release
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule test "scopes/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule pre-publish "scopes/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule show "scopes/kuard/terraform-submodules/helm-release"
    - step: &publish-scopes-kuard-terraform-submodules-helm-release
        name: publish scopes/kuard/terraform-submodules/helm-release
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/terraform-submodules/helm-release/**"
        caches:
          - scopes-kuard-terraform-submodules-helm-release
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule test "scopes/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule publish "scopes/kuard/terraform-submodules/helm-release"
          - ./scripts/terraform-submodule show "scopes/kuard/terraform-submodules/helm-release"
    - step: &test-scopes-kuard-terraform-submodules-kuard
        name: test scopes/kuard/terraform-submodules/kuard
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/terraform-submodules/kuard/**"
        caches:
          - scopes-kuard-terraform-submodules-kuard
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule test "scopes/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule pre-publish "scopes/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule show "scopes/kuard/terraform-submodules/kuard"
    - step: &publish-scopes-kuard-terraform-submodules-kuard
        name: publish scopes/kuard/terraform-submodules/kuard
        condition:
          changesets:
            includePaths:
              - "scopes/kuard/terraform-submodules/kuard/**"
        caches:
          - scopes-kuard-terraform-submodules-kuard
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule test "scopes/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule publish "scopes/kuard/terraform-submodules/kuard"
          - ./scripts/terraform-submodule show "scopes/kuard/terraform-submodules/kuard"
    - step: &validate-scopes-o11y-terraform-modules-test-monitor
        name: validate scopes/o11y/terraform-modules/test-monitor
        condition:
          changesets:
            includePaths:
              - "scopes/o11y/terraform-modules/test-monitor/**"
        caches:
          - scopes-o11y-terraform-modules-test-monitor
        script:
          - *auth
          - ./scripts/terraform-module test "scopes/o11y/terraform-modules/test-monitor"
    - step: &plan-scopes-o11y-terraform-modules-test-monitor
        name: plan scopes/o11y/terraform-modules/test-monitor
        condition:
          changesets:
            includePaths:
              - "scopes/o11y/terraform-modules/test-monitor/**"
        caches:
          - scopes-o11y-terraform-modules-test-monitor
        script:
          - *auth
          - terraform -chdir="scopes/o11y/terraform-modules/test-monitor" init -input="false"
          - terraform -chdir="scopes/o11y/terraform-modules/test-monitor" plan -input="false"
    - step: &apply-scopes-o11y-terraform-modules-test-monitor
        name: apply scopes/o11y/terraform-modules/test-monitor
        condition:
          changesets:
            includePaths:
              - "scopes/o11y/terraform-modules/test-monitor/**"
        caches:
          - scopes-o11y-terraform-modules-test-monitor
        script:
          - *auth
          - terraform -chdir="scopes/o11y/terraform-modules/test-monitor" init -input="false"
          - terraform -chdir="scopes/o11y/terraform-modules/test-monitor" apply -input="false" -auto-approve
        trigger: manual
    - step: &test-scopes-o11y-terraform-submodules-gcp-availability-monitor
        name: test scopes/o11y/terraform-submodules/gcp-availability-monitor
        condition:
          changesets:
            includePaths:
              - "scopes/o11y/terraform-submodules/gcp-availability-monitor/**"
        caches:
          - scopes-o11y-terraform-submodules-gcp-availability-monitor
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule test "scopes/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule pre-publish "scopes/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule show "scopes/o11y/terraform-submodules/gcp-availability-monitor"
    - step: &publish-scopes-o11y-terraform-submodules-gcp-availability-monitor
        name: publish scopes/o11y/terraform-submodules/gcp-availability-monitor
        condition:
          changesets:
            includePaths:
              - "scopes/o11y/terraform-submodules/gcp-availability-monitor/**"
        caches:
          - scopes-o11y-terraform-submodules-gcp-availability-monitor
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule test "scopes/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule publish "scopes/o11y/terraform-submodules/gcp-availability-monitor"
          - ./scripts/terraform-submodule show "scopes/o11y/terraform-submodules/gcp-availability-monitor"
    - step: &test-scopes-o11y-terraform-submodules-gke-lgtm-stack
        name: test scopes/o11y/terraform-submodules/gke-lgtm-stack
        condition:
          changesets:
            includePaths:
              - "scopes/o11y/terraform-submodules/gke-lgtm-stack/**"
        caches:
          - scopes-o11y-terraform-submodules-gke-lgtm-stack
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule test "scopes/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule pre-publish "scopes/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule show "scopes/o11y/terraform-submodules/gke-lgtm-stack"
    - step: &publish-scopes-o11y-terraform-submodules-gke-lgtm-stack
        name: publish scopes/o11y/terraform-submodules/gke-lgtm-stack
        condition:
          changesets:
            includePaths:
              - "scopes/o11y/terraform-submodules/gke-lgtm-stack/**"
        caches:
          - scopes-o11y-terraform-submodules-gke-lgtm-stack
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule test "scopes/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule publish "scopes/o11y/terraform-submodules/gke-lgtm-stack"
          - ./scripts/terraform-submodule show "scopes/o11y/terraform-submodules/gke-lgtm-stack"
    - step: &test-scopes-o11y-terraform-submodules-k8s-otel-collectors
        name: test scopes/o11y/terraform-submodules/k8s-otel-collectors
        condition:
          changesets:
            includePaths:
              - "scopes/o11y/terraform-submodules/k8s-otel-collectors/**"
        caches:
          - scopes-o11y-terraform-submodules-k8s-otel-collectors
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule test "scopes/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule pre-publish "scopes/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule show "scopes/o11y/terraform-submodules/k8s-otel-collectors"
    - step: &publish-scopes-o11y-terraform-submodules-k8s-otel-collectors
        name: publish scopes/o11y/terraform-submodules/k8s-otel-collectors
        condition:
          changesets:
            includePaths:
              - "scopes/o11y/terraform-submodules/k8s-otel-collectors/**"
        caches:
          - scopes-o11y-terraform-submodules-k8s-otel-collectors
        script:
          - *auth
          - ./scripts/terraform-submodule build "scopes/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule test "scopes/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule publish "scopes/o11y/terraform-submodules/k8s-otel-collectors"
          - ./scripts/terraform-submodule show "scopes/o11y/terraform-submodules/k8s-otel-collectors"

pipelines:
  pull-requests:
    "**":
      - parallel:
          - step: *test-scopes-core-docker-images-devcontainer
          - step: *test-scopes-core-docker-images-go-rte
          - step: *test-scopes-core-docker-images-go-sdk
          - step: *validate-scopes-core-terraform-modules-main
          - step: *validate-scopes-core-terraform-modules-prod
          - step: *validate-scopes-core-terraform-modules-test
          - step: *test-scopes-core-terraform-submodules-gcp-docker-images-registry
          - step: *test-scopes-core-terraform-submodules-gcp-helm-charts-registry
          - step: *test-scopes-core-terraform-submodules-gcp-project
          - step: *test-scopes-core-terraform-submodules-gcp-terraform-modules-registry
          - step: *test-scopes-core-terraform-submodules-gcp-terraform-state-bucket
          - step: *test-scopes-core-terraform-submodules-gke-gateway-route
          - step: *test-scopes-core-terraform-submodules-gke-platform
          - step: *test-scopes-core-terraform-submodules-gke-service-account
          - step: *test-scopes-kuard-docker-images-kuard
          - step: *test-scopes-kuard-helm-charts-kuard
          - step: *validate-scopes-kuard-terraform-modules-kuard
          - step: *test-scopes-kuard-terraform-submodules-helm-release
          - step: *test-scopes-kuard-terraform-submodules-kuard
          - step: *validate-scopes-o11y-terraform-modules-test-monitor
          - step: *test-scopes-o11y-terraform-submodules-gcp-availability-monitor
          - step: *test-scopes-o11y-terraform-submodules-gke-lgtm-stack
          - step: *test-scopes-o11y-terraform-submodules-k8s-otel-collectors
      - parallel:
          - step: *plan-scopes-core-terraform-modules-main
          - step: *plan-scopes-core-terraform-modules-prod
          - step: *plan-scopes-core-terraform-modules-test
          - step: *plan-scopes-kuard-terraform-modules-kuard
          - step: *plan-scopes-o11y-terraform-modules-test-monitor
  branches:
    main:
      - parallel:
          - step: *publish-scopes-core-docker-images-devcontainer
          - step: *publish-scopes-core-docker-images-go-rte
          - step: *publish-scopes-core-docker-images-go-sdk
          - step: *publish-scopes-core-terraform-submodules-gcp-docker-images-registry
          - step: *publish-scopes-core-terraform-submodules-gcp-helm-charts-registry
          - step: *publish-scopes-core-terraform-submodules-gcp-project
          - step: *publish-scopes-core-terraform-submodules-gcp-terraform-modules-registry
          - step: *publish-scopes-core-terraform-submodules-gcp-terraform-state-bucket
          - step: *publish-scopes-core-terraform-submodules-gke-gateway-route
          - step: *publish-scopes-core-terraform-submodules-gke-platform
          - step: *publish-scopes-core-terraform-submodules-gke-service-account
          - step: *publish-scopes-kuard-docker-images-kuard
          - step: *publish-scopes-kuard-helm-charts-kuard
          - step: *publish-scopes-kuard-terraform-submodules-helm-release
          - step: *publish-scopes-kuard-terraform-submodules-kuard
          - step: *publish-scopes-o11y-terraform-submodules-gcp-availability-monitor
          - step: *publish-scopes-o11y-terraform-submodules-gke-lgtm-stack
          - step: *publish-scopes-o11y-terraform-submodules-k8s-otel-collectors
      - parallel:
          - step: *plan-scopes-core-terraform-modules-main
          - step: *plan-scopes-core-terraform-modules-prod
          - step: *plan-scopes-core-terraform-modules-test
          - step: *plan-scopes-kuard-terraform-modules-kuard
          - step: *plan-scopes-o11y-terraform-modules-test-monitor
      - parallel:
          - step: *apply-scopes-core-terraform-modules-main
          - step: *apply-scopes-core-terraform-modules-prod
          - step: *apply-scopes-core-terraform-modules-test
          - step: *apply-scopes-kuard-terraform-modules-kuard
          - step: *apply-scopes-o11y-terraform-modules-test-monitor
